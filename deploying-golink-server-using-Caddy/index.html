<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>    Deploying a short-link aka go-link server using only Caddyserver
 | I think ...</title>
<meta content="Khaled Monsoor" name="author"/>
<meta content="Pelican v4.6.0" name="generator"/>
<link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/css/bootstrap.min.css" integrity="sha512-oc9+XSs1H243/FRN9Rw62Fn8EtxjEYWHXRvjS43YtueEewbS6ObfXcJNyohjHqVKFPoXXUxwc+q1K7Dee6vv9g==" rel="stylesheet"/>
<link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" rel="stylesheet"/>
<link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css" integrity="sha512-+EoPw+Fiwh6eSeRK7zwIKG2MA8i3rV/DGa3tdttQGgWyatG/SkncT53KHQaS5Jh9MNOT3dmFL0FjTY08And/Cw==" rel="stylesheet"/>
<link href="../theme/css/main.min.css?3fd22780" rel="stylesheet"/>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-20431143-1"></script>
<script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-20431143-1');
    </script>
<script crossorigin="anonymous" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script crossorigin="anonymous" integrity="sha512-iceXjjbmB2rwoX93Ka6HAHP+B76IY1z0o3h+N1PeDtRSsyeetU3/0QKJqGyPJcX63zysNehggFwMC/bi7dvMig==" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/js/bootstrap.bundle.min.js"></script>
<script crossorigin="anonymous" integrity="sha512-IsNh5E3eYy3tr/JiX2Yx4vsCujtkhwl7SLqgnwLNgf04Hrt9BT9SXlLlZlWx+OK4ndzAoALhsMNcCmkggjZB1w==" src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>
<script crossorigin="anonymous" integrity="sha512-/2sZKAsHDmHNoevKR/xsUKe+Bpf692q4tHNQs9VWWz0ujJ9JBM67iFYbIEdfDV9I2BaodgT5MIg/FTUmUv3oyQ==" src="https://cdnjs.cloudflare.com/ajax/libs/fitvids/1.2.0/jquery.fitvids.min.js"></script>
<script src="../theme/js/main.min.js?86e1c044"></script>
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180"/>
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"/>
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"/>
<link href="/site.webmanifest" rel="manifest"/>
<link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon"/>
<meta content="#ffc40d" name="msapplication-TileColor"/>
<meta content="#ffffff" name="theme-color"/>
<!-- Feeds -->
<link href="https://blog.kmonsoor.com/feed/atom/index.html" rel="alternate" title="I think ... - Latest posts - Atom Feed" type="application/atom+xml"/>
<link href="https://blog.kmonsoor.com/feed/index.html" rel="alternate" title="I think ... - Latest posts - RSS Feed" type="application/rss+xml"/>
<link href="https://blog.kmonsoor.com/category/tech/feed/atom/index.html" rel="alternate" title="I think ... - Category: Tech - Atom Feed" type="application/atom+xml"/>
<link href="https://blog.kmonsoor.com/category/tech/feed/index.html" rel="alternate" title="I think ... - Category: Tech - RSS Feed" type="application/rss+xml"/>
<meta content="caddy, webserver, url-shortener, Caddyfile, web-link, go-link" name="keywords"/>
<link href="https://blog.kmonsoor.com/deploying-golink-server-using-Caddy/" rel="canonical"/><script type="application/ld+json">{"@context": "https://schema.org", "@type": "BreadcrumbList", "itemListElement": [{"@type": "ListItem", "position": 1, "name": "I think ...", "item": "https://blog.kmonsoor.com"}, {"@type": "ListItem", "position": 2, "name": "Deploying golink server using caddy", "item": "https://blog.kmonsoor.com/deploying-golink-server-using-Caddy"}, {"@type": "ListItem", "position": 3, "name": "Index", "item": "https://blog.kmonsoor.com/deploying-golink-server-using-Caddy/index.html"}]}</script><script type="application/ld+json">{"@context": "https://schema.org", "@type": "Article", "author": {"@type": "Person", "name": "Khaled Monsoor"}, "publisher": {"@type": "Organization", "name": "I think ..."}, "headline": "Deploying a short-link aka go-link server using only&nbsp;Caddyserver", "about": "Tech", "datePublished": "2021-04-16 00:00"}</script></head>
<body class="bg-transparent pt-4">
<div class="container">
<a class="avatar-container float-left mx-4" href="..">
<div class="avatar animate">
<div class="side"><img class="img-fluid" src="/logo.png"/></div>
<div class="side back text-center pt-2 px-1 small">
                                comes with a beard
                            </div>
</div>
</a>
<h1>
<a class="text-dark text-decoration-none" href="..">I think ...</a>
<small class="text-secondary"><small></small></small>
</h1>
<nav class="navbar d-block navbar-expand-lg navbar-light bg-light shadow rounded-lg">
<a class="navbar-brand d-none" href=".." title="">I think ...</a>
<button aria-controls="plumage-navbar-collapse-1" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#plumage-navbar-collapse-1" data-toggle="collapse" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<div class="collapse navbar-collapse" id="plumage-navbar-collapse-1">
<ul class="navbar-nav mr-auto mt-2 mt-lg-0">
<li class="nav-item">
<a class="nav-link" href="/">
                                    Home
                                </a>
</li>
<li class="nav-item">
<a class="nav-link" href="../about/">
                                        About Me
                                    </a>
</li>
<li class="nav-item">
<a class="nav-link" href="../category/language/">
                                        Language
                                    </a>
</li>
<li class="nav-item">
<a class="nav-link" href="../category/tech/">
                                        Tech
<span class="sr-only">(current)</span> </a>
</li>
<li class="nav-item">
<a class="nav-link" href="../category/thoughts/">
                                        Thoughts
                                    </a>
</li>
</ul>
</div>
</nav>
</div>
<div class="container mt-5">
<div class="row">
<div class="col-md-9">
<h1>
<a href="../deploying-golink-server-using-Caddy/" rel="bookmark" title="Permalink to Deploying a short-link aka go-link server using only Caddyserver">Deploying a short-link aka go-link server using only Caddyserver</a>
</h1>
</div>
</div>
<div class="row">
<div class="col-md-9" id="content" role="main">
<p>Before I go into any details, please note that I’ve used the term “shortlink-server” instead of “url-shortener” because the difference is significant for this post. 
A url-shortener takes a long url, and gives a short url, then redirects any requests for the shortened link to its long counterpart. On the contrary, shortlink-server takes both the long and short url, then only does the redirect-ion part.</p>
<h2 id="backstory">Backstory<a class="headerlink text-decoration-none small pl-2" href="#backstory" title="Permanent link">¶</a></h2>
<p>If I wanted an amazing, personal url-shortener or “go link” server, there are many amazing solutions out there, which are not only free or open-source but full-fledged as well for personal or public usage. Rather, I wanted some “service” that will “resolve” my personal, short links. I have been using bit.ly for a long time for its customizable “short-half” part, but the problem with bit.ly is – for some God-forsaken reason – blocked by the Bangladeshi govt. So, I needed a replacement to be properly “glocal”.
There are many free (unbranded) and commercial (branded) options as well, but I wanted something that will be resolved via my hosted service (and personal domain) and as cheap as possible. So, basically solution for a poor nerd :D</p>
<p>Before jumped into this solution, I tried (deployed <span class="amp">&amp;</span> tested) few others myself, mainly <a href="https://github.com/kellegous/go">kellegous/go</a>, <a href="kutt.it">kutt.it</a> and <a href="https://github.com/adamyi/golinks">adamyi/golinks</a>. But, all of them “too featureful” for my needs. </p>
<p><img alt="Simple, on-prem short-link server using Caddy webserver" class="img-fluid border rounded shadow image-process-article-photo" src="https://i.imgur.com/4nZbnUE.png"/></p>
<p>What I wanted is to be able to:</p>
<ul>
<li>resolve only my custom shortlinks (hence, no need for url-shortener)</li>
<li>not a public, internet-facing service (hence, any frontend, authentication, email verification etc. would be overkill )</li>
<li>minimal setup (if possible, no webapp at all)</li>
</ul>
<p>Given my previous experience with <code>Caddy</code> webserver, which is an amazing one(<a href="https://caddyserver.com/docs/">why?</a>), I had a gut feeling that Caddy has something for me – under the sleeve – to meet my minimal set of requirements. Thankfully, I managed to find it.</p>
<p>I believe <span class="caps">NGINX</span>, currently the most popular webserver, has some kind of similar mechanism as well. But, I’m not an expert, and once I was genuinely intimidated by its config file syntax. <span class="caps">YMMV</span>.</p>
<h2 id="what-you-gonna-need">What you gonna need?<a class="headerlink text-decoration-none small pl-2" href="#what-you-gonna-need" title="Permanent link">¶</a></h2>
<ul>
<li>your own domain which will be the root of the shortlinks. While sub-domained <span class="caps">URL</span> like <code>go.yourname.com/*</code> is quite common, if you have some short domain, like you.co/*, only for this purpose, that’s fine as well.</li>
<li>A webhost server or public-facing instance with its own, <strong>public</strong> IPv4 address.</li>
<li>working knowledge of Linux</li>
</ul>
<h2 id="step-1-point-your-subdomain-to-the-right-place">Step-1: Point your subdomain to the right place<a class="headerlink text-decoration-none small pl-2" href="#step-1-point-your-subdomain-to-the-right-place" title="Permanent link">¶</a></h2>
<ul>
<li>Find out what’s the <strong>puplic IPv4 address</strong> of your instance that’ll act as the webserver. It’s usually on the cloud management dashboard.<ul>
<li>make sure that, regardless of your cloud architecture (e.g. <span class="caps">VPC</span>, subnet, firewall etc.), the <span class="caps">SSL</span> port (<code>:443</code>) of the instance is reachable from the public internet.</li>
</ul>
</li>
<li>now go to your domain name registrar (or, <span class="caps">DNS</span> management provider which in my case is Cloudflare). There, you need to point shortlink subdomain (<code>go.</code>)to the webserver’s <span class="caps">IP</span> address.</li>
</ul>
<p>Actually, you can do this step at the last. But for some reason, I prefer it to do first. Because sometimes, <a href="https://blog.cloudflare.com/never-deal-with-dns-propagation-again/"><span class="caps">DNS</span> propagation</a> takes some time. But, once my webservice is up and running, I like to see the result instantaneously. ;)</p>
<h2 id="step-2-install-caddy-the-mighty-webserver">Step-2: Install Caddy, the mighty webserver<a class="headerlink text-decoration-none small pl-2" href="#step-2-install-caddy-the-mighty-webserver" title="Permanent link">¶</a></h2>
<p>Depending on your host <span class="caps">OS</span> (mine is Ubuntu 20.04 <span class="caps">LTS</span>), you need to install the <code>Caddy</code> webserver. While there are some hacky solutions to run, I think running Caddy as a background server is the simplest to manage.
In fact, the documentation of Caddy is excellent, I’d better leave that part to you. </p>
<p>After running with the default config(<code>Caddyfile</code>) which is in Ubuntu’s case located as <code>/etc/caddy/Caddyfile</code>, it should have a status somewhat like the below image. Please note that, in many cases, if running without <code>sudo</code> Caddy cannot attach itself with the <span class="caps">SSL</span> port (<code>:443</code>) which is necessary for serving <code>https://</code>.  So, check for that error message in the “status” log.</p>
<p><img alt="Caddy service on Ubuntu" class="img-fluid border rounded shadow image-process-article-photo" src="https://i.imgur.com/cfS5nvZ.png?1"/></p>
<p><em><strong><span class="caps">P.S.</span></strong> By the way, want your console and command prompt to look 🚀 like mine? Here’s the guide: <a href="https://blog.kmonsoor.com/pimp-up-my-terminal/">How do I pimp up my terminal on Linux</a></em></p>
<h2 id="step-3-tell-caddy-your-short-links-to-redirect">Step-3: Tell Caddy your short-links to redirect<a class="headerlink text-decoration-none small pl-2" href="#step-3-tell-caddy-your-short-links-to-redirect" title="Permanent link">¶</a></h2>
<p>Now, it’s time to configure Caddy to actually do the job.</p>
<p>Caddy has its native <code>redir</code> <span class="dquo">“</span>directive” to redirect incoming web-request from one to another. While the <code>map</code> directive is relatively new, it makes the config file i.e. Caddyfile look elegant in case you have (or, will have in the long run) a long list of short-links.</p>
<p>Here’s mine which is working …  </p>
<div class="highlight pygments-style-monokai rounded shadow-sm mb-3"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span># /etc/caddy/Caddyfile
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span>go.kmonsoor.com {   # replace it your web-url root
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>    map {path} {redirect-uri} {
<span class="linenos" data-linenos=" 6 "></span>        /blog    https://blog.kmonsoor.com
<span class="linenos" data-linenos=" 7 "></span>        /photos  https://photos.kmonsoor.com
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>        /resume     https://drive.google.com/file/d/1nMS3i1ai6nsI70zZ7NFnNQ_XmvAa4GOl
<span class="linenos" data-linenos="10 "></span>        /resume-doc https://docs.google.com/document/d/1ECx1Yr8Jzz9I3S5VcoKnZQz56oIht2XaM5gSNetcWag
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span>        /rickrolled    https://www.youtube.com/watch?v=dQw4w9WgXcQ
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span>        # will add new ones here like the above
<span class="linenos" data-linenos="15 "></span>        # ...
<span class="linenos" data-linenos="16 "></span>    }
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span>    # this below code is required to actually make the above `map` work
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span>    @hasRedir expression `{redirect-uri} != ""`
<span class="linenos" data-linenos="21 "></span>    redir @hasRedir {redirect-uri}
<span class="linenos" data-linenos="22 "></span>
<span class="linenos" data-linenos="23 "></span>    # code below is to set the default response if the requested shortlink isn't here
<span class="linenos" data-linenos="24 "></span>    respond "Thas's an unknown short URL ... :("  
<span class="linenos" data-linenos="25 "></span>}
</code></pre></div>
<p>Note: Don’t forget to restart the <code>caddy</code> service to let the new config to take effect.</p>
<h2 id="step-4-profit">Step-4: Profit !<a class="headerlink text-decoration-none small pl-2" href="#step-4-profit" title="Permanent link">¶</a></h2>
<p>Yeah, that’s it. Now, add some own personal stuff with some cool short-links, and proudly share with the world.</p>
<h2 id="whats-next">What’s next ?<a class="headerlink text-decoration-none small pl-2" href="#whats-next" title="Permanent link">¶</a></h2>
<p>I’m thinking that given the very low workload my shortlink resolver needs — unless I’m becoming an overnight internet sensation — using a server instance only for this purpose is overkill. My next goal is to have the same service using some “serverless” function or using the “<a href="https://developers.cloudflare.com/workers/examples/redirect">worker on the edge</a>” thing from Cloudflare. Let’s see ;)</p>
<h3 class="mt-3">Related content</h3>
<div class="list-group bg-light text-dark">
<a class="list-group-item list-group-item-action" href="../golink-server-using-cloudflare-worker-kv/">
<div class="d-flex w-100 justify-content-between">
<h5>Create a free go-link server “on edge” using Cloudflare Worker <span class="caps">KV</span></h5>
<abbr class="small published" title="2021-06-06T00:00:00+06:00">
                            2021
                        </abbr>
</div>
<small>Among quite a few ways to implement a go-link server (i.e. url-forwarder, short-url server etc.), here I’m going to show you how to use free-tier Cloudflare Worker (&amp; KV) to create an in-house, on-edge, no-webserver go-link server.</small>
</a>
</div>
</div>
<div class="col-md-3">
<div class="card bg-light text-dark">
<ul class="list-group list-group-flush">
<li class="list-group-item">
<abbr title="2021-04-16T00:00:00+06:00"><i class="fas fa-calendar"></i> 2021-04-16</abbr>
</li>
<li class="list-group-item">
<a class="badge badge-info" data-toggle="tooltip" href="../category/tech/" rel="tag" title="26 articles in this category">Tech</a>
<a class="badge badge-secondary" data-toggle="tooltip" href="/tag/go-link/" title="2 articles with this tag">go-link</a>
<a class="badge badge-secondary" data-toggle="tooltip" href="/tag/url-shortener/" title="2 articles with this tag">url-shortener</a>
<a class="badge badge-secondary" data-toggle="tooltip" href="/tag/caddy/" title="1 article with this tag">caddy</a>
<a class="badge badge-secondary" data-toggle="tooltip" href="/tag/caddyfile/" title="1 article with this tag">Caddyfile</a>
<a class="badge badge-secondary" data-toggle="tooltip" href="/tag/web-link/" title="1 article with this tag">web-link</a>
<a class="badge badge-secondary" data-toggle="tooltip" href="/tag/webserver/" title="1 article with this tag">webserver</a>
</li>
<li class="list-group-item">
<p>Found a typo? Fix it now:</p>
<a class="btn btn-info btn-block" href="https://github.com/kmonsoor/blog.kmonsoor.com/edit/live/content/articles/deploying-golink-server-using-Caddy.md"><i class="fas fa-edit fa-fw"></i> Edit article on GitHub</a>
</li>
<li class="list-group-item">
<nav class="nav nav-pills nav-fill">
<a class="nav-link btn btn-outline-primary border-0" href="../pimp-up-my-terminal/" rel="prev" title="How do I Pimp up My Terminal on Linux">
<span aria-hidden="true">←</span> Older
                        </a>
<a class="nav-link btn btn-outline-primary border-0" href="../TLDR-what-cloud-to-use-2021/" rel="next" title="TL;DR what cloud provider to use in 2021">
                            Newer <span aria-hidden="true">→</span>
</a>
</nav>
</li>
</ul>
</div>
</div>
</div>
</div>
<footer class="container-fluid mt-5 p-4 small">
<div class="row mx-5">
<div class="col-md-2">
<h6>Social</h6>
<ul class="list-unstyled">
<li><a href="https://twitter.com/kmonsoor">
<i class="fab fa-twitter fa-fw"></i>
    Twitter
</a></li>
</ul>
</div>
<div class="col-md-2">
<h6>Professional</h6>
<ul class="list-unstyled">
<li><a href="https://stackoverflow.com/users/617185/kmonsoor">
<i class="fab fa-stack-overflow fa-fw"></i>
    StackOverflow
</a></li>
<li><a href="https://linkedin.com/in/kmonsoor">
<i class="fab fa-linkedin fa-fw"></i>
    LinkedIn
</a></li>
<li><a href="https://github.com/kmonsoor/">
<i class="fab fa-github fa-fw"></i>
    Github
</a></li>
</ul>
</div>
<div class="col-md-2">
<h6>Browse content by</h6>
<ul class="list-unstyled">
<li><a href="../categories/index.html"><i class="fas fa-th fa-fw"></i> Categories</a></li>
<li><a href="../archives/index.html"><i class="far fa-calendar-alt fa-fw"></i> Dates</a></li>
<li><a href="../tags/index.html"><i class="fas fa-tags fa-fw"></i> Tags</a></li>
</ul>
</div>
<div class="col-md-2 text-muted">
<h6>Copyright notice</h6>
<p class="small">
                        © Copyright
                        2010-2021
                        Khaled Monsoor.
                    </p>
</div>
<div class="col-md-2 text-muted">
<h6>Disclaimer</h6>
<p class="small">
                            All opinions expressed in this site are my own personal opinions               and are not endorsed by, nor do they represent the opinions of my               previous, current and future employers or any of its affiliates,               partners or customers.
                    </p>
</div>
<div class="col-md-2">
<h6>Feeds</h6>
<ul class="list-unstyled small">
<li>
<a href="https://blog.kmonsoor.com/feed/atom/index.html">
<i class="fas fa-atom fa-fw"></i> Latest posts (Atom)
                                    </a>
</li>
<li>
<a href="https://blog.kmonsoor.com/feed/index.html">
<i class="fas fa-rss fa-fw"></i> Latest posts (RSS)
                                    </a>
</li>
<li>
<a href="https://blog.kmonsoor.com/category/tech/feed/atom/index.html">
<i class="fas fa-atom fa-fw"></i> Category: Tech (Atom)
                                    </a>
</li>
<li>
<a href="https://blog.kmonsoor.com/category/tech/feed/index.html">
<i class="fas fa-rss fa-fw"></i> Category: Tech (RSS)
                                    </a>
</li>
</ul>
</div>
</div>
<div class="row mt-3">
<div class="offset-3 col-6 small text-muted text-center">
                    Site generated by <a class="text-dark" href="https://getpelican.com">Pelican</a>.<br/>
<a class="text-dark" href="https://github.com/kdeldycke/plumage">Plumage</a>
                    theme by <a class="text-dark" href="https://kevin.deldycke.com">Kevin Deldycke</a>.
                </div>
<div class="col-3 text-right d-flex flex-column">
<a class="mt-auto" href="#"><i class="fas fa-arrow-up"></i> Back to top</a>
</div>
</div>
</footer>
</body>
</html>