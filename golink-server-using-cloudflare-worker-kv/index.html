<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>    Create a free go-link server “on edge” using Cloudflare Worker KV
 | I think ...</title>
<meta content="Khaled Monsoor" name="author"/>
<meta content="Pelican v4.6.0" name="generator"/>
<link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/css/bootstrap.min.css" integrity="sha512-oc9+XSs1H243/FRN9Rw62Fn8EtxjEYWHXRvjS43YtueEewbS6ObfXcJNyohjHqVKFPoXXUxwc+q1K7Dee6vv9g==" rel="stylesheet"/>
<link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" rel="stylesheet"/>
<link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css" integrity="sha512-+EoPw+Fiwh6eSeRK7zwIKG2MA8i3rV/DGa3tdttQGgWyatG/SkncT53KHQaS5Jh9MNOT3dmFL0FjTY08And/Cw==" rel="stylesheet"/>
<link href="../theme/css/main.min.css?c3e3f661" rel="stylesheet"/>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-20431143-1"></script>
<script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-20431143-1');
    </script>
<script crossorigin="anonymous" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script crossorigin="anonymous" integrity="sha512-iceXjjbmB2rwoX93Ka6HAHP+B76IY1z0o3h+N1PeDtRSsyeetU3/0QKJqGyPJcX63zysNehggFwMC/bi7dvMig==" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/js/bootstrap.bundle.min.js"></script>
<script crossorigin="anonymous" integrity="sha512-IsNh5E3eYy3tr/JiX2Yx4vsCujtkhwl7SLqgnwLNgf04Hrt9BT9SXlLlZlWx+OK4ndzAoALhsMNcCmkggjZB1w==" src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>
<script crossorigin="anonymous" integrity="sha512-/2sZKAsHDmHNoevKR/xsUKe+Bpf692q4tHNQs9VWWz0ujJ9JBM67iFYbIEdfDV9I2BaodgT5MIg/FTUmUv3oyQ==" src="https://cdnjs.cloudflare.com/ajax/libs/fitvids/1.2.0/jquery.fitvids.min.js"></script>
<script src="../theme/webassets-external/9c7dcf71957efaca317d5233af56d4f0_jquery.mglass.js"></script>
<script src="../theme/webassets-external/d9c86f33b63c3c484c04107bdbaa0c73_application.js"></script>
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180"/>
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"/>
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"/>
<link href="/site.webmanifest" rel="manifest"/>
<link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon"/>
<meta content="#ffc40d" name="msapplication-TileColor"/>
<meta content="#ffffff" name="theme-color"/>
<!-- Feeds -->
<link href="https://blog.kmonsoor.com/feed/atom/index.html" rel="alternate" title="I think ... - Latest posts - Atom Feed" type="application/atom+xml"/>
<link href="https://blog.kmonsoor.com/feed/index.html" rel="alternate" title="I think ... - Latest posts - RSS Feed" type="application/rss+xml"/>
<link href="https://blog.kmonsoor.com/category/tech/feed/atom/index.html" rel="alternate" title="I think ... - Category: Tech - Atom Feed" type="application/atom+xml"/>
<link href="https://blog.kmonsoor.com/category/tech/feed/index.html" rel="alternate" title="I think ... - Category: Tech - RSS Feed" type="application/rss+xml"/>
<meta content="cloud, computing, url-shortener, url-forwarder, Cloudflare, Cloudflare Worker, Cloudflare KV, Workers KV, on edge, free, go-link" name="keywords"/>
<link href="https://blog.kmonsoor.com/golink-server-using-cloudflare-worker-kv/" rel="canonical"/><script type="application/ld+json">{"@context": "https://schema.org", "@type": "BreadcrumbList", "itemListElement": [{"@type": "ListItem", "position": 1, "name": "I think ...", "item": "https://blog.kmonsoor.com"}, {"@type": "ListItem", "position": 2, "name": "Golink server using cloudflare worker kv", "item": "https://blog.kmonsoor.com/golink-server-using-cloudflare-worker-kv"}, {"@type": "ListItem", "position": 3, "name": "Index", "item": "https://blog.kmonsoor.com/golink-server-using-cloudflare-worker-kv/index.html"}]}</script><script type="application/ld+json">{"@context": "https://schema.org", "@type": "Article", "author": {"@type": "Person", "name": "Khaled Monsoor"}, "publisher": {"@type": "Organization", "name": "I think ..."}, "headline": "Create a free go-link server &#8220;on edge&#8221; using Cloudflare Worker <span class=\"caps\">KV</span>", "about": "Tech", "datePublished": "2021-06-06 00:00"}</script></head>
<body class="bg-transparent pt-4">
<div class="container">
<a class="avatar-container float-left mx-4" href="..">
<div class="avatar animate">
<div class="side"><img class="img-fluid" src="/logo.png"/></div>
<div class="side back text-center pt-2 px-1 small">
                                comes with a beard
                            </div>
</div>
</a>
<h1>
<a class="text-dark text-decoration-none" href="..">I think ...</a>
<small class="text-secondary"><small></small></small>
</h1>
<nav class="navbar d-block navbar-expand-lg navbar-light bg-light shadow rounded-lg">
<a class="navbar-brand d-none" href=".." title="">I think ...</a>
<button aria-controls="plumage-navbar-collapse-1" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#plumage-navbar-collapse-1" data-toggle="collapse" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<div class="collapse navbar-collapse" id="plumage-navbar-collapse-1">
<ul class="navbar-nav mr-auto mt-2 mt-lg-0">
<li class="nav-item">
<a class="nav-link" href="/">
                                    Home
                                </a>
</li>
<li class="nav-item">
<a class="nav-link" href="../about/">
                                        About Me
                                    </a>
</li>
</ul>
</div>
</nav>
</div>
<div class="container mt-5">
<div class="row">
<div class="col-md-9">
<h1>
<a href="../golink-server-using-cloudflare-worker-kv/" rel="bookmark" title="Permalink to Create a free go-link server “on edge” using Cloudflare Worker KV">Create a free go-link server “on edge” using Cloudflare Worker <span class="caps">KV</span></a>
</h1>
</div>
</div>
<div class="row">
<div class="col-md-9" id="content" role="main">
<p>Among quite a few ways to implement a go-link server (i.e. url-forwarder, short-url server etc.), here I’m going to show you how to use free-tier Cloudflare Worker (&amp; <span class="caps">KV</span>) to create an in-house, on-edge, <strong>no-webserver</strong> go-link server.</p>
<p>For example, the short-link for this article is <code>go.kmonsoor.com/golink-kv</code></p>
<ul>
<li><code>/latest</code> (by which I mean <code>go.yourdomain.co/latest</code>) may point to <code>https://www.yourcompany.com/about/news</code> which is a public page</li>
<li><code>/hr-help</code> may point to <code>https://www.company-internal.com/long-link/hr/contact.html</code> which is company’s internal human-resources help portal</li>
<li><code>/cnypromo</code> may point to <code>https://shop.yourcompany.com/sales/promotions/?marketing-promo=2021-cny</code> which is a temporary sales promotions page targeting the shoppers during the Chinese new year of 2021.</li>
</ul>
<p>Please note that using the setup and the code below, it’ll be possible resolve shortlinks via a <strong>single</strong> sub-domain, e.g. <code>go.your-domain.co</code>. However, it’s totally possible (with some modification of the code) to resolve/re-direct via <em>any number of domains</em> (your own, of course) towards any other public or private <span class="caps">URL</span>, and all sorts of novelties. However, for brevity’s sake, I’m going to discuss the first one, single sub-domain usecase.</p>
<p>To setup a go-link server or short-<span class="caps">URL</span> resolver via a proper <span class="caps">KV</span>+Worker combination, we’ll go through these steps:</p>
<div class="toc">
<ul>
<li><a href="#pre-requisites">Pre-requisites</a></li>
<li><a href="#create-the-short-link-map-as-a-kv">Create the short-link map as a <span class="caps">KV</span></a></li>
<li><a href="#mapping-a-kv-to-a-worker-variable">Mapping a <span class="caps">KV</span> to a Worker variable</a></li>
<li><a href="#handling-a-route-with-webworker">Handling a route with webworker</a></li>
<li><a href="#create-the-worker">Create the Worker</a></li>
<li><a href="#pointing-a-dns-record-to-the-worker">Pointing a <span class="caps">DNS</span> record to the Worker</a></li>
<li><a href="#next-step">Next step</a></li>
<li><a href="#related">Related</a></li>
</ul>
</div>
<h1 id="pre-requisites">Pre-requisites<a class="headerlink text-decoration-none small pl-2" href="#pre-requisites" title="Permanent link">¶</a></h1>
<ul>
<li>The <span class="caps">DNS</span> resolver for the <strong>root</strong> domain (in the example below, <em><code>kmonsoor.com</code></em>) needs to be Cloudflare. Because the core of the solution, the “worker”, runs on the nearest (from the user) edge of Cloudflare using a common <span class="caps">KV</span> (“key, value”) list.</li>
<li>Write permission to the <span class="caps">DNS</span> configuration as you’d need to add a new <span class="caps">AAAA</span> <span class="caps">DNS</span> record.</li>
<li>Some knowledge of Javascript(<span class="caps">ES6</span>), as we gonna write the worker in that language.</li>
</ul>
<h1 id="create-the-short-link-map-as-a-kv">Create the short-link map as a <span class="caps">KV</span><a class="headerlink text-decoration-none small pl-2" href="#create-the-short-link-map-as-a-kv" title="Permanent link">¶</a></h1>
<p>We’ll start the setup by creating the short-link map, the list between the short-link segments that you (or, someone in your org) define and the actual URLs they needed to point to.</p>
<p>Find the <span class="caps">KV</span> stuff in the <code>Workers</code> section. From the screenshot, please ignore the “Route” section for now.  </p>
<p><img alt="Find the KV stuff in the Workers section" class="img-fluid border rounded shadow image-process-article-photo" src="https://i.imgur.com/b2Rk45u.png"/></p>
<ul>
<li>you’d need to create a Worker <span class="caps">KV</span> “Namespace”. Name the namespace as you seem fit. I named it <code>REDIRECTS</code> (in all caps just as convention, not required). </li>
<li>List the short-links <span class="amp">&amp;</span> their respective target URLs. From the examples in the intro, the keys <code>latest</code>, <code>hr-help</code>, <code>cnypromo</code> etc. would be in as the “key”, and the target full links as the respective “value”.</li>
<li>Remember <span class="caps">NOT</span> to start the short part with ‘/’. In the code, it’ll be taken care of.</li>
</ul>
<p><img alt="Create the short-link map as a KV" class="img-fluid border rounded shadow image-process-article-photo" src="https://i.imgur.com/jkC8bSr.png"/></p>
<p>Once you’ve listed all your desired (short-link, target-link) combinations, now we have a <span class="caps">KV</span> on CLoudflare. However, it’s not referencable from your Worker code, not yet. Hence the next step.</p>
<h1 id="mapping-a-kv-to-a-worker-variable">Mapping a <span class="caps">KV</span> to a Worker variable<a class="headerlink text-decoration-none small pl-2" href="#mapping-a-kv-to-a-worker-variable" title="Permanent link">¶</a></h1>
<p>Now, we gonna map the previously created <span class="caps">KV</span> to a variable that can be referenced from our Workeer code. Please note that though I used diffrent names, but it can be same as well. Also note that a single <span class="caps">KV</span> can be accessed by multiple workers, and vice versa, a single Worker can reference multiple KVs.</p>
<p><img alt="Mapping a KV to a Worker variable" class="img-fluid border rounded shadow image-process-article-photo" src="https://i.imgur.com/lb7G9si.png"/></p>
<h1 id="handling-a-route-with-webworker">Handling a route with webworker<a class="headerlink text-decoration-none small pl-2" href="#handling-a-route-with-webworker" title="Permanent link">¶</a></h1>
<p><img alt="Handling a route with webworker" class="img-fluid border rounded shadow image-process-article-photo" src="https://i.imgur.com/KohHRfR.png"/></p>
<h1 id="create-the-worker">Create the Worker<a class="headerlink text-decoration-none small pl-2" href="#create-the-worker" title="Permanent link">¶</a></h1>
<p>Now, we going to write Workercode that runs on V8-runtime on an nearest(from the requesting user) edge location of Cloudflare to complete its functionality and deliver it to the user. Tn this case, that would be to redirect user’s requested address to the mapped one by you, in the <span class="caps">KV</span> namespace above.</p>
<p><img alt="Creating a worker" class="img-fluid border rounded shadow image-process-article-photo" src="https://i.imgur.com/eNfZNyN.png"/></p>
<p>The code editor looks like this:  </p>
<p><img alt="The code editor for Cloudflare worker" class="img-fluid border rounded shadow image-process-article-photo" src="https://i.imgur.com/pb9AE9v.png"/></p>
<p>If you rather prefer to copy-paste, please feel free to do it from the below GitHub Gist.</p>
<div class="gist">
<script src="https://gist.github.com/kmonsoor/dc9f96660423c96471f8574ba018d867.js"></script>
</div>
<p>Once done, it should look like …
<img alt="created webworker" class="img-fluid border rounded shadow image-process-article-photo" src="https://i.imgur.com/XSdKB56.png"/></p>
<h1 id="pointing-a-dns-record-to-the-worker">Pointing a <span class="caps">DNS</span> record to the Worker<a class="headerlink text-decoration-none small pl-2" href="#pointing-a-dns-record-to-the-worker" title="Permanent link">¶</a></h1>
<p>Finally, we need to point a <span class="caps">DNS</span> record that’ll redirect all requests to your re-soutign sub-domain (e.g. <code>go.your-domain.com</code>) to the Cloudflare Worker that we just created.</p>
<p>According to the Cloudflare docs, the <span class="caps">DNNS</span> record must be an <span class="caps">AAAA</span> record, pointing to the IPv6 address <code>100:</code>. The “Name” here is the “sub-domain” part of your choice which is better be short to serve our goal here.  </p>
<p><img alt="Pointing a DNS record to it" class="img-fluid border rounded shadow image-process-article-photo" src="https://i.imgur.com/62bk7pe.png"/></p>
<p>Voila ! Now, test some of the short-urls that you’ve mapped via the <span class="caps">KV</span>. Enjoy !
Watch out for the target usage though <a href="https://developers.cloudflare.com/workers/platform/limits#worker-limits">against the limit</a>.  </p>
<p>I think you’ll be fine, unnless you’re some kind of celebrity ;)</p>
<h1 id="next-step">Next step<a class="headerlink text-decoration-none small pl-2" href="#next-step" title="Permanent link">¶</a></h1>
<p>As the next next step, I’m thinking to create a generic <code>Go/Link</code> resolver browser extension. Then, someone can set their own default domain or company domain of choice as short-domain host. In that case, entering just <code>go/hr-help</code> on the browser will take to <code>https://www.company-internal.com/.../hr/contact.html</code> that we have discussed at the beginning (remember the example case of an internal human resources help portal?).</p>
<h1 id="related">Related<a class="headerlink text-decoration-none small pl-2" href="#related" title="Permanent link">¶</a></h1>
<ul>
<li>If you want to do this url-direction <strong>on your own webserver, but only using webserver</strong>, try this: <a href="https://blog.kmonsoor.com/personal-shortlink-server-using-Caddy/">Personal short-link server using only Caddyserver</a></li>
</ul>
<h3 class="mt-3">Related content</h3>
<div class="list-group bg-light text-dark">
<a class="list-group-item list-group-item-action" href="../TLDR-what-cloud-to-use-2021/">
<div class="d-flex w-100 justify-content-between">
<h5><span class="caps">TL</span>;<span class="caps">DR</span> what cloud provider to use in 2021</h5>
<abbr class="small published" title="2021-05-22T00:00:00+06:00">
                            2021
                        </abbr>
</div>
<small>Among the thousands of combinations a company can take to choose from the cloud providers and their products, this is my TL;DR suggestion</small>
</a>
<a class="list-group-item list-group-item-action" href="../personal-shortlink-server-using-Caddy/">
<div class="d-flex w-100 justify-content-between">
<h5>Personal short-link server using only Caddyserver</h5>
<abbr class="small published" title="2021-04-16T00:00:00+06:00">
                            2021
                        </abbr>
</div>
<small>Yeah, there are tons of open-source, full-fledged link-shorteners. But, none were exactly what I wanted. Hence, the minimal approach only utilizing the amazing webserver, Caddy. Here we go …</small>
</a>
<a class="list-group-item list-group-item-action" href="../bangla-font-design-characters-flow/">
<div class="d-flex w-100 justify-content-between">
<h5>Characters Efficient Flow in Designing Bangla Font</h5>
<abbr class="small published" title="2013-08-22T00:00:00+06:00">
                            2013
                        </abbr>
</div>
<small>How to efficiently progress in designing font through Bangla characters.</small>
</a>
</div>
</div>
<div class="col-md-3">
<div class="card bg-light text-dark">
<ul class="list-group list-group-flush">
<li class="list-group-item">
<abbr title="2021-06-06T00:00:00+06:00"><i class="fas fa-calendar"></i> 2021-06-06</abbr>
</li>
<li class="list-group-item">
<a class="badge badge-info" data-toggle="tooltip" href="../category/tech/" rel="tag" title="27 articles in this category">Tech</a>
<a class="badge badge-secondary" data-toggle="tooltip" href="/tag/computing/" title="5 articles with this tag">computing</a>
<a class="badge badge-secondary" data-toggle="tooltip" href="/tag/cloud/" title="2 articles with this tag">cloud</a>
<a class="badge badge-secondary" data-toggle="tooltip" href="/tag/free/" title="2 articles with this tag">free</a>
<a class="badge badge-secondary" data-toggle="tooltip" href="/tag/url-shortener/" title="2 articles with this tag">url-shortener</a>
<a class="badge badge-secondary" data-toggle="tooltip" href="/tag/cloudflare/" title="1 article with this tag">Cloudflare</a>
<a class="badge badge-secondary" data-toggle="tooltip" href="/tag/cloudflare-kv/" title="1 article with this tag">Cloudflare KV</a>
<a class="badge badge-secondary" data-toggle="tooltip" href="/tag/cloudflare-worker/" title="1 article with this tag">Cloudflare Worker</a>
<a class="badge badge-secondary" data-toggle="tooltip" href="/tag/go-link/" title="1 article with this tag">go-link</a>
<a class="badge badge-secondary" data-toggle="tooltip" href="/tag/on-edge/" title="1 article with this tag">on edge</a>
<a class="badge badge-secondary" data-toggle="tooltip" href="/tag/url-forwarder/" title="1 article with this tag">url-forwarder</a>
<a class="badge badge-secondary" data-toggle="tooltip" href="/tag/workers-kv/" title="1 article with this tag">Workers KV</a>
</li>
<li class="list-group-item">
<p>Found a typo? Fix it now:</p>
<a class="btn btn-info btn-block" href="https://github.com/kmonsoor/blog.kmonsoor.com/edit/live/content/articles/golink-server-using-cloudflare-worker-kv.md"><i class="fas fa-edit fa-fw"></i> Edit article on GitHub</a>
</li>
<li class="list-group-item">
<nav class="nav nav-pills nav-fill">
<a class="nav-link btn btn-outline-primary border-0" href="../TLDR-what-cloud-to-use-2021/" rel="prev" title="TL;DR what cloud provider to use in 2021">
<span aria-hidden="true">←</span> Older
                        </a>
<a class="nav-link btn btn-outline-primary border-0 disabled" rel="next">
                            Newer <span aria-hidden="true">→</span>
</a>
</nav>
</li>
</ul>
</div>
</div>
</div>
</div>
<footer class="container-fluid mt-5 p-4 small">
<div class="row mx-5">
<div class="col-md-2">
<h6>Social</h6>
<ul class="list-unstyled">
<li><a href="https://twitter.com/kmonsoor">
<i class="fab fa-twitter fa-fw"></i>
    Twitter
</a></li>
</ul>
</div>
<div class="col-md-2">
<h6>Professional</h6>
<ul class="list-unstyled">
<li><a href="https://stackoverflow.com/users/617185/kmonsoor">
<i class="fab fa-stack-overflow fa-fw"></i>
    StackOverflow
</a></li>
<li><a href="https://linkedin.com/in/kmonsoor">
<i class="fab fa-linkedin fa-fw"></i>
    LinkedIn
</a></li>
<li><a href="https://github.com/kmonsoor/">
<i class="fab fa-github fa-fw"></i>
    Github
</a></li>
</ul>
</div>
<div class="col-md-2">
<h6>Browse content by</h6>
<ul class="list-unstyled">
<li><a href="../categories/index.html"><i class="fas fa-th fa-fw"></i> Categories</a></li>
<li><a href="../archives/index.html"><i class="far fa-calendar-alt fa-fw"></i> Dates</a></li>
<li><a href="../tags/index.html"><i class="fas fa-tags fa-fw"></i> Tags</a></li>
</ul>
</div>
<div class="col-md-2 text-muted">
<h6>Copyright notice</h6>
<p class="small">
                        © Copyright
                        2010-2021
                        Khaled Monsoor.
                    </p>
</div>
<div class="col-md-2 text-muted">
<h6>Disclaimer</h6>
<p class="small">
                            All opinions expressed in this site are my own personal opinions               and are not endorsed by, nor do they represent the opinions of my               previous, current and future employers or any of its affiliates,               partners or customers.
                    </p>
</div>
<div class="col-md-2">
<h6>Feeds</h6>
<ul class="list-unstyled small">
<li>
<a href="https://blog.kmonsoor.com/feed/atom/index.html">
<i class="fas fa-atom fa-fw"></i> Latest posts (Atom)
                                    </a>
</li>
<li>
<a href="https://blog.kmonsoor.com/feed/index.html">
<i class="fas fa-rss fa-fw"></i> Latest posts (RSS)
                                    </a>
</li>
<li>
<a href="https://blog.kmonsoor.com/category/tech/feed/atom/index.html">
<i class="fas fa-atom fa-fw"></i> Category: Tech (Atom)
                                    </a>
</li>
<li>
<a href="https://blog.kmonsoor.com/category/tech/feed/index.html">
<i class="fas fa-rss fa-fw"></i> Category: Tech (RSS)
                                    </a>
</li>
</ul>
</div>
</div>
<div class="row mt-3">
<div class="offset-3 col-6 small text-muted text-center">
                    Site generated by <a class="text-dark" href="https://getpelican.com">Pelican</a>.<br/>
<a class="text-dark" href="https://github.com/kdeldycke/plumage">Plumage</a>
                    theme by <a class="text-dark" href="https://kevin.deldycke.com">Kevin Deldycke</a>.
                </div>
<div class="col-3 text-right d-flex flex-column">
<a class="mt-auto" href="#"><i class="fas fa-arrow-up"></i> Back to top</a>
</div>
</div>
</footer>
</body>
</html>