<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>I think ... - cloud</title><link href="https://blog.kmonsoor.com/" rel="alternate"></link><link href="https://blog.kmonsoor.com/tag/cloud/feed/atom/index.html" rel="self"></link><id>https://blog.kmonsoor.com/</id><updated>2021-06-06T00:00:00+06:00</updated><entry><title>Create a free go-link server ‚Äúon edge‚Äù using Cloudflare Worker KV</title><link href="https://blog.kmonsoor.com/golink-server-using-cloudflare-worker-kv/" rel="alternate"></link><published>2021-06-06T00:00:00+06:00</published><updated>2021-06-06T00:00:00+06:00</updated><author><name>Khaled Monsoor</name></author><id>tag:blog.kmonsoor.com,2021-06-06:/golink-server-using-cloudflare-worker-kv/</id><summary type="html">&lt;p&gt;Among quite a few ways to implement a go-link server (i.e. url-forwarder, short-url server etc.), here I&amp;rsquo;m going to show you how to use free-tier Cloudflare Worker (&amp;amp; &lt;span class="caps"&gt;KV&lt;/span&gt;) to create an in-house, on-edge, &lt;strong&gt;no-webserver&lt;/strong&gt; go-link&amp;nbsp;server.&lt;/p&gt;</summary><content type="html">&lt;p&gt;Among quite a few ways to implement a go-link server (i.e. url-forwarder, short-url server etc.), here I&amp;rsquo;m going to show you how to use free-tier Cloudflare Worker (&amp;amp; &lt;span class="caps"&gt;KV&lt;/span&gt;) to create an in-house, on-edge, &lt;strong&gt;no-webserver&lt;/strong&gt; go-link&amp;nbsp;server.&lt;/p&gt;
&lt;p&gt;For example, the short-link for this article is &lt;a href="https://go.kmonsoor.com/golink-kv"&gt;go.kmonsoor.com/golink-kv&lt;/a&gt;  &lt;/p&gt;
&lt;p&gt;&lt;img alt="overall structure" src="https://i.imgur.com/MjIS5gD.png"&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;/latest&lt;/code&gt; (by which I mean &lt;code&gt;go.yourdomain.co/latest&lt;/code&gt;) may point to &lt;code&gt;https://www.yourcompany.com/about/news&lt;/code&gt; which is a public&amp;nbsp;page&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/hr-help&lt;/code&gt; may point to &lt;code&gt;https://www.company-internal.com/long-link/hr/contact.html&lt;/code&gt; which is company&amp;rsquo;s internal human-resources help&amp;nbsp;portal&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/cnypromo&lt;/code&gt; may point to &lt;code&gt;https://shop.yourcompany.com/sales/promotions/?marketing-promo=2021-cny&lt;/code&gt; which is a temporary sales promotions page targeting the shoppers during the Chinese new year of&amp;nbsp;2021.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Please note that using the setup and the code below, it&amp;rsquo;ll be possible resolve shortlinks via a &lt;strong&gt;single&lt;/strong&gt; sub-domain, e.g. &lt;code&gt;go.your-domain.co&lt;/code&gt;. However, it&amp;rsquo;s totally possible (with some modification of the code) to resolve/re-direct via &lt;em&gt;any number of domains&lt;/em&gt; (your own, of course) towards any other public or private &lt;span class="caps"&gt;URL&lt;/span&gt;, and all sorts of novelties. However, for brevity&amp;rsquo;s sake, I&amp;rsquo;m going to discuss the first one, single sub-domain&amp;nbsp;usecase.&lt;/p&gt;
&lt;p&gt;To setup a go-link server or short-&lt;span class="caps"&gt;URL&lt;/span&gt; resolver via a proper &lt;span class="caps"&gt;KV&lt;/span&gt;+Worker combination, we&amp;rsquo;ll go through these&amp;nbsp;steps:&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#pre-requisites"&gt;Pre-requisites&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#create-the-short-link-map-as-a-kv"&gt;Create the short-link map as a &lt;span class="caps"&gt;KV&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#mapping-a-kv-to-a-worker-variable"&gt;Mapping a &lt;span class="caps"&gt;KV&lt;/span&gt; to a Worker&amp;nbsp;variable&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#handling-a-route-with-webworker"&gt;Handling a route with&amp;nbsp;webworker&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#create-the-worker"&gt;Create the&amp;nbsp;Worker&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#pointing-a-dns-record-to-the-worker"&gt;Pointing a &lt;span class="caps"&gt;DNS&lt;/span&gt; record to the&amp;nbsp;Worker&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#next-step"&gt;Next&amp;nbsp;step&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#related"&gt;Related&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h1 id="pre-requisites"&gt;Pre-requisites&lt;a class="headerlink" href="#pre-requisites" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;The &lt;span class="caps"&gt;DNS&lt;/span&gt; resolver for the &lt;strong&gt;root&lt;/strong&gt; domain (in the example below, &lt;em&gt;&lt;code&gt;kmonsoor.com&lt;/code&gt;&lt;/em&gt;) needs to be Cloudflare. Because the core of the solution, the &amp;ldquo;worker&amp;rdquo;, runs on the nearest (from the user) edge of Cloudflare using a common &lt;span class="caps"&gt;KV&lt;/span&gt; (&amp;ldquo;key, value&amp;rdquo;)&amp;nbsp;list.&lt;/li&gt;
&lt;li&gt;Write permission to the &lt;span class="caps"&gt;DNS&lt;/span&gt; configuration as you&amp;rsquo;d need to add a new &lt;span class="caps"&gt;AAAA&lt;/span&gt; &lt;span class="caps"&gt;DNS&lt;/span&gt;&amp;nbsp;record.&lt;/li&gt;
&lt;li&gt;Some knowledge of Javascript(&lt;span class="caps"&gt;ES6&lt;/span&gt;), as we gonna write the worker in that&amp;nbsp;language.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="create-the-short-link-map-as-a-kv"&gt;Create the short-link map as a &lt;span class="caps"&gt;KV&lt;/span&gt;&lt;a class="headerlink" href="#create-the-short-link-map-as-a-kv" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;We&amp;rsquo;ll start the setup by creating the short-link map, the list between the short-link segments that you (or, someone in your org) define and the actual URLs they needed to point&amp;nbsp;to.&lt;/p&gt;
&lt;p&gt;Find the &lt;span class="caps"&gt;KV&lt;/span&gt; stuff in the &lt;code&gt;Workers&lt;/code&gt; section. From the screenshot, please ignore the &amp;ldquo;Route&amp;rdquo; section for&amp;nbsp;now.  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Find the KV stuff in the Workers section" src="https://i.imgur.com/b2Rk45u.png"&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;you&amp;rsquo;d need to create a Worker &lt;span class="caps"&gt;KV&lt;/span&gt; &amp;ldquo;Namespace&amp;rdquo;. Name the namespace as you seem fit. I named it &lt;code&gt;REDIRECTS&lt;/code&gt; (in all caps just as convention, not&amp;nbsp;required). &lt;/li&gt;
&lt;li&gt;List the short-links &lt;span class="amp"&gt;&amp;amp;&lt;/span&gt; their respective target URLs. From the examples in the intro, the keys &lt;code&gt;latest&lt;/code&gt;, &lt;code&gt;hr-help&lt;/code&gt;, &lt;code&gt;cnypromo&lt;/code&gt; etc. would be in as the &amp;ldquo;key&amp;rdquo;, and the target full links as the respective&amp;nbsp;&amp;ldquo;value&amp;rdquo;.&lt;/li&gt;
&lt;li&gt;Remember &lt;span class="caps"&gt;NOT&lt;/span&gt; to start the short part with &amp;lsquo;/&amp;rsquo;. In the code, it&amp;rsquo;ll be taken care&amp;nbsp;of.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="Create the short-link map as a KV" src="https://i.imgur.com/jkC8bSr.png"&gt;&lt;/p&gt;
&lt;p&gt;Once you&amp;rsquo;ve listed all your desired (short-link, target-link) combinations, now we have a &lt;span class="caps"&gt;KV&lt;/span&gt; on CLoudflare. However, it&amp;rsquo;s not referencable from your Worker code, not yet. Hence the next&amp;nbsp;step.&lt;/p&gt;
&lt;h1 id="mapping-a-kv-to-a-worker-variable"&gt;Mapping a &lt;span class="caps"&gt;KV&lt;/span&gt; to a Worker variable&lt;a class="headerlink" href="#mapping-a-kv-to-a-worker-variable" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Now, we gonna map the previously created &lt;span class="caps"&gt;KV&lt;/span&gt; to a variable that can be referenced from our Workeer code. Please note that though I used diffrent names, but it can be same as well. Also note that a single &lt;span class="caps"&gt;KV&lt;/span&gt; can be accessed by multiple workers, and vice versa, a single Worker can reference multiple&amp;nbsp;KVs.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Mapping a KV to a Worker variable" src="https://i.imgur.com/lb7G9si.png"&gt;&lt;/p&gt;
&lt;h1 id="handling-a-route-with-webworker"&gt;Handling a route with webworker&lt;a class="headerlink" href="#handling-a-route-with-webworker" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;&lt;img alt="Handling a route with webworker" src="https://i.imgur.com/KohHRfR.png"&gt;&lt;/p&gt;
&lt;h1 id="create-the-worker"&gt;Create the Worker&lt;a class="headerlink" href="#create-the-worker" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Now, we going to write Workercode that runs on V8-runtime on an nearest(from the requesting user) edge location of Cloudflare to complete its functionality and deliver it to the user. Tn this case, that would be to redirect user&amp;rsquo;s requested address to the mapped one by you, in the &lt;span class="caps"&gt;KV&lt;/span&gt; namespace&amp;nbsp;above.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Creating a worker" src="https://i.imgur.com/eNfZNyN.png"&gt;&lt;/p&gt;
&lt;p&gt;The code editor looks like&amp;nbsp;this:  &lt;/p&gt;
&lt;p&gt;&lt;img alt="The code editor for Cloudflare worker" src="https://i.imgur.com/pb9AE9v.png"&gt;&lt;/p&gt;
&lt;p&gt;If you rather prefer to copy-paste, please feel free to do it from the below GitHub&amp;nbsp;Gist.&lt;/p&gt;
&lt;div class="gist"&gt;
&lt;script src="https://gist.github.com/kmonsoor/dc9f96660423c96471f8574ba018d867.js"&gt;&lt;/script&gt;
&lt;/div&gt;

&lt;p&gt;Once done, it should look like &amp;hellip;
&lt;img alt="created webworker" src="https://i.imgur.com/XSdKB56.png"&gt;&lt;/p&gt;
&lt;h1 id="pointing-a-dns-record-to-the-worker"&gt;Pointing a &lt;span class="caps"&gt;DNS&lt;/span&gt; record to the Worker&lt;a class="headerlink" href="#pointing-a-dns-record-to-the-worker" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Finally, we need to point a &lt;span class="caps"&gt;DNS&lt;/span&gt; record that&amp;rsquo;ll redirect all requests to your re-soutign sub-domain (e.g. &lt;code&gt;go.your-domain.com&lt;/code&gt;) to the Cloudflare Worker that we just&amp;nbsp;created.&lt;/p&gt;
&lt;p&gt;According to the Cloudflare docs, the &lt;span class="caps"&gt;DNNS&lt;/span&gt; record must be an &lt;span class="caps"&gt;AAAA&lt;/span&gt; record, pointing to the IPv6 address &lt;code&gt;100::&lt;/code&gt;. The &amp;ldquo;Name&amp;rdquo; here is the &amp;ldquo;sub-domain&amp;rdquo; part of your choice which is better be short to serve our goal&amp;nbsp;here.  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pointing a DNS record to it" src="https://i.imgur.com/62bk7pe.png"&gt;&lt;/p&gt;
&lt;p&gt;Voila ! Now, test some of the short-urls that you&amp;rsquo;ve mapped via the &lt;span class="caps"&gt;KV&lt;/span&gt;. Enjoy !
Watch out for the target usage though &lt;a href="https://developers.cloudflare.com/workers/platform/limits#worker-limits"&gt;against the limit&lt;/a&gt;.  &lt;/p&gt;
&lt;p&gt;I think you&amp;rsquo;ll be fine, unnless you&amp;rsquo;re some kind of celebrity&amp;nbsp;;)&lt;/p&gt;
&lt;h1 id="next-step"&gt;Next step&lt;a class="headerlink" href="#next-step" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;As the next next step, I&amp;rsquo;m thinking to create a generic &lt;code&gt;Go/Link&lt;/code&gt; resolver browser extension. Then, someone can set their own default domain or company domain of choice as short-domain host. In that case, entering just &lt;code&gt;go/hr-help&lt;/code&gt; on the browser will take to &lt;code&gt;https://www.company-internal.com/.../hr/contact.html&lt;/code&gt; that we have discussed at the beginning (remember the example case of an internal human resources help&amp;nbsp;portal?).&lt;/p&gt;
&lt;h1 id="related"&gt;Related&lt;a class="headerlink" href="#related" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;If you want to do this url-direction &lt;strong&gt;on your own webserver, but only using webserver&lt;/strong&gt;, try this: &lt;a href="https://blog.kmonsoor.com/personal-shortlink-server-using-Caddy/"&gt;Personal short-link server using only&amp;nbsp;Caddyserver&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="Tech"></category><category term="cloud"></category><category term="computing"></category><category term="url-shortener"></category><category term="url-forwarder"></category><category term="Cloudflare"></category><category term="Cloudflare Worker"></category><category term="Cloudflare KV"></category><category term="Workers KV"></category><category term="on edge"></category><category term="free"></category><category term="go-link"></category></entry><entry><title>TL;DR what cloud provider to use in¬†2021</title><link href="https://blog.kmonsoor.com/TLDR-what-cloud-to-use-2021/" rel="alternate"></link><published>2021-05-22T00:00:00+06:00</published><updated>2021-05-22T00:00:00+06:00</updated><author><name>Khaled Monsoor</name></author><id>tag:blog.kmonsoor.com,2021-05-22:/TLDR-what-cloud-to-use-2021/</id><summary type="html">&lt;p&gt;Among the thousands of combinations a company can take to choose from the cloud providers and their products, this is my &lt;span class="caps"&gt;TL&lt;/span&gt;;&lt;span class="caps"&gt;DR&lt;/span&gt;&amp;nbsp;suggestion&lt;/p&gt;</summary><content type="html">&lt;p&gt;The sheer number of combinations a company can choose from the cloud providers and their product suites is mind-boggling. Hence, I decided to break it down in a concise form for the busy C-suite&amp;nbsp;executives.&lt;/p&gt;
&lt;p&gt;According to my little experiences and humble opinion, I suggest&amp;nbsp;&amp;hellip;&lt;/p&gt;
&lt;p&gt;‚û§ If your company is a small SaaS shop with 10-ish engineers, stick with DigitalOcean, Linode, &lt;span class="caps"&gt;OVH&lt;/span&gt;, etc., which are best known as cloud &amp;ldquo;instance&amp;rdquo; providers.&lt;br&gt;
Think McDonald&amp;rsquo;s; reliable, cheapest, fast, but you won&amp;rsquo;t take your date there. &lt;br&gt;
&lt;strong&gt;Budget&lt;/strong&gt;:&amp;nbsp;üí∞&lt;/p&gt;
&lt;p&gt;‚û§ If you want a whole cloud experience (e.g., &lt;span class="caps"&gt;VPC&lt;/span&gt;, firewall, &lt;span class="caps"&gt;WAF&lt;/span&gt;, etc., on the menu), start with Google Cloud, then try &lt;span class="caps"&gt;AWS&lt;/span&gt; later.&lt;br&gt;
Google Cloud would be the quickest to grasp the cloud concepts and get going. The &lt;span class="caps"&gt;UI&lt;/span&gt; of the &lt;span class="caps"&gt;AWS&lt;/span&gt; console is a bit messy compared to &lt;span class="caps"&gt;GCP&lt;/span&gt;; it just takes more time to get a proper grip.&lt;br&gt;
Imagine them as full-course, Michelin-star restaurants. However, the product names are so abstract that they need a full-sized chart for that. ;) 
&lt;strong&gt;Budget&lt;/strong&gt;:&amp;nbsp;üí∞üí∞üí∞&lt;/p&gt;
&lt;p&gt;‚û§ Are you planning to set up a million-dollar infra for a billion-dollar company? Go for some &lt;span class="caps"&gt;GCP&lt;/span&gt;+&lt;span class="caps"&gt;AWS&lt;/span&gt; multi-cloud setup. You gonna get rebates from both on the scale of hundreds of thousands of dollars. And Microsoft Azure gonna offer you some million-$ free-tier, hoping to get the company hooked on Azure. :D 
&lt;strong&gt;Budget&lt;/strong&gt;:&amp;nbsp;üí∞üí∞&lt;/p&gt;
&lt;p&gt;‚û§ On the other hand, if you run a govt agency or a company where wearing suits is the mainstream, Microsoft Azure is your best bet.&lt;br&gt;
A bunch of consultancy companies to choose from; you need to just approve the budget, you get the things to get up &lt;span class="amp"&gt;&amp;amp;&lt;/span&gt; running but miss the deadline by months, if not years. But there&amp;rsquo;d be no need for hiring more smarter ppl than that you already have. 
&lt;strong&gt;Budget&lt;/strong&gt;:&amp;nbsp;üí∞üí∞üí∏&lt;/p&gt;
&lt;p&gt;Need an even more comprehensive guide? Gotcha, fam&amp;nbsp;&amp;hellip;&lt;/p&gt;
&lt;blockquote class="twitter-tweet"&gt;&lt;p lang="en" dir="ltr"&gt;&lt;span class="caps"&gt;CTO&lt;/span&gt;: we&amp;#39;re having hard time choosing a cloud provider&lt;br&gt;&amp;#8230;&lt;br&gt;&amp;#8220;say no more, fam, I gotcha &amp;#8230;&amp;#8221; &lt;a href="https://t.co/hR3rMruWWi"&gt;pic.twitter.com/hR3rMruWWi&lt;/a&gt;&lt;/p&gt;&amp;mdash; Khaled Monsoor ‚ú® (@kmonsoor) &lt;a href="https://twitter.com/kmonsoor/status/1395959443376857088?ref_src=twsrc%5Etfw"&gt;May 22, 2021&lt;/a&gt;&lt;/blockquote&gt;
&lt;script async src="https://platform.twitter.com/widgets.js" charset="utf-8"&gt;&lt;/script&gt;

&lt;p&gt;&lt;em&gt;&lt;span class="caps"&gt;PS&lt;/span&gt;&lt;/em&gt; This post is inspired by a LinkedIn post of mine where I shared about my short experience with the Microsoft Azure &lt;strong&gt;DevOps&lt;/strong&gt;&amp;nbsp;suite&lt;/p&gt;</content><category term="Tech"></category><category term="computing"></category><category term="cloud"></category><category term="2021"></category><category term="AWS"></category><category term="GCP"></category><category term="Azure"></category><category term="Google Cloud"></category><category term="IaaS"></category></entry></feed>