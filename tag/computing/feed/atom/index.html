<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>I think ... - computing</title><link href="https://blog.kmonsoor.com/" rel="alternate"></link><link href="https://blog.kmonsoor.com/tag/computing/feed/atom/index.html" rel="self"></link><id>https://blog.kmonsoor.com/</id><updated>2021-06-06T00:00:00+06:00</updated><entry><title>Create a free go-link server ‚Äúon edge‚Äù using Cloudflare Worker KV</title><link href="https://blog.kmonsoor.com/golink-server-using-cloudflare-worker-kv/" rel="alternate"></link><published>2021-06-06T00:00:00+06:00</published><updated>2021-06-06T00:00:00+06:00</updated><author><name>Khaled Monsoor</name></author><id>tag:blog.kmonsoor.com,2021-06-06:/golink-server-using-cloudflare-worker-kv/</id><summary type="html">&lt;p&gt;Among quite a few ways to implement a go-link server (i.e. url-forwarder, short-url server etc.), here I&amp;rsquo;m going to show you how to use free-tier Cloudflare Worker (&amp;amp; &lt;span class="caps"&gt;KV&lt;/span&gt;) to create an in-house, on-edge, &lt;strong&gt;no-webserver&lt;/strong&gt; go-link&amp;nbsp;server.&lt;/p&gt;</summary><content type="html">&lt;p&gt;Among quite a few ways to implement a go-link server (i.e. url-forwarder, short-url server etc.), here I&amp;rsquo;m going to show you how to use free-tier Cloudflare Worker (&amp;amp; &lt;span class="caps"&gt;KV&lt;/span&gt;) to create an in-house, on-edge, &lt;strong&gt;no-webserver&lt;/strong&gt; go-link&amp;nbsp;server.&lt;/p&gt;
&lt;p&gt;For example, the short-link for this article is &lt;a href="https://go.kmonsoor.com/golink-kv"&gt;go.kmonsoor.com/golink-kv&lt;/a&gt;  &lt;/p&gt;
&lt;p&gt;&lt;img alt="overall structure" src="https://i.imgur.com/MjIS5gD.png"&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;/latest&lt;/code&gt; (by which I mean &lt;code&gt;go.yourdomain.co/latest&lt;/code&gt;) may point to &lt;code&gt;https://www.yourcompany.com/about/news&lt;/code&gt; which is a public&amp;nbsp;page&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/hr-help&lt;/code&gt; may point to &lt;code&gt;https://www.company-internal.com/long-link/hr/contact.html&lt;/code&gt; which is company&amp;rsquo;s internal human-resources help&amp;nbsp;portal&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/cnypromo&lt;/code&gt; may point to &lt;code&gt;https://shop.yourcompany.com/sales/promotions/?marketing-promo=2021-cny&lt;/code&gt; which is a temporary sales promotions page targeting the shoppers during the Chinese new year of&amp;nbsp;2021.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Please note that using the setup and the code below, it&amp;rsquo;ll be possible resolve shortlinks via a &lt;strong&gt;single&lt;/strong&gt; sub-domain, e.g. &lt;code&gt;go.your-domain.co&lt;/code&gt;. However, it&amp;rsquo;s totally possible (with some modification of the code) to resolve/re-direct via &lt;em&gt;any number of domains&lt;/em&gt; (your own, of course) towards any other public or private &lt;span class="caps"&gt;URL&lt;/span&gt;, and all sorts of novelties. However, for brevity&amp;rsquo;s sake, I&amp;rsquo;m going to discuss the first one, single sub-domain&amp;nbsp;usecase.&lt;/p&gt;
&lt;p&gt;To setup a go-link server or short-&lt;span class="caps"&gt;URL&lt;/span&gt; resolver via a proper &lt;span class="caps"&gt;KV&lt;/span&gt;+Worker combination, we&amp;rsquo;ll go through these&amp;nbsp;steps:&lt;/p&gt;
&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#pre-requisites"&gt;Pre-requisites&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#create-the-short-link-map-as-a-kv"&gt;Create the short-link map as a &lt;span class="caps"&gt;KV&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#mapping-a-kv-to-a-worker-variable"&gt;Mapping a &lt;span class="caps"&gt;KV&lt;/span&gt; to a Worker&amp;nbsp;variable&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#handling-a-route-with-webworker"&gt;Handling a route with&amp;nbsp;webworker&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#create-the-worker"&gt;Create the&amp;nbsp;Worker&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#pointing-a-dns-record-to-the-worker"&gt;Pointing a &lt;span class="caps"&gt;DNS&lt;/span&gt; record to the&amp;nbsp;Worker&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#next-step"&gt;Next&amp;nbsp;step&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#related"&gt;Related&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h1 id="pre-requisites"&gt;Pre-requisites&lt;a class="headerlink" href="#pre-requisites" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;The &lt;span class="caps"&gt;DNS&lt;/span&gt; resolver for the &lt;strong&gt;root&lt;/strong&gt; domain (in the example below, &lt;em&gt;&lt;code&gt;kmonsoor.com&lt;/code&gt;&lt;/em&gt;) needs to be Cloudflare. Because the core of the solution, the &amp;ldquo;worker&amp;rdquo;, runs on the nearest (from the user) edge of Cloudflare using a common &lt;span class="caps"&gt;KV&lt;/span&gt; (&amp;ldquo;key, value&amp;rdquo;)&amp;nbsp;list.&lt;/li&gt;
&lt;li&gt;Write permission to the &lt;span class="caps"&gt;DNS&lt;/span&gt; configuration as you&amp;rsquo;d need to add a new &lt;span class="caps"&gt;AAAA&lt;/span&gt; &lt;span class="caps"&gt;DNS&lt;/span&gt;&amp;nbsp;record.&lt;/li&gt;
&lt;li&gt;Some knowledge of Javascript(&lt;span class="caps"&gt;ES6&lt;/span&gt;), as we gonna write the worker in that&amp;nbsp;language.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="create-the-short-link-map-as-a-kv"&gt;Create the short-link map as a &lt;span class="caps"&gt;KV&lt;/span&gt;&lt;a class="headerlink" href="#create-the-short-link-map-as-a-kv" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;We&amp;rsquo;ll start the setup by creating the short-link map, the list between the short-link segments that you (or, someone in your org) define and the actual URLs they needed to point&amp;nbsp;to.&lt;/p&gt;
&lt;p&gt;Find the &lt;span class="caps"&gt;KV&lt;/span&gt; stuff in the &lt;code&gt;Workers&lt;/code&gt; section. From the screenshot, please ignore the &amp;ldquo;Route&amp;rdquo; section for&amp;nbsp;now.  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Find the KV stuff in the Workers section" src="https://i.imgur.com/b2Rk45u.png"&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;you&amp;rsquo;d need to create a Worker &lt;span class="caps"&gt;KV&lt;/span&gt; &amp;ldquo;Namespace&amp;rdquo;. Name the namespace as you seem fit. I named it &lt;code&gt;REDIRECTS&lt;/code&gt; (in all caps just as convention, not&amp;nbsp;required). &lt;/li&gt;
&lt;li&gt;List the short-links &lt;span class="amp"&gt;&amp;amp;&lt;/span&gt; their respective target URLs. From the examples in the intro, the keys &lt;code&gt;latest&lt;/code&gt;, &lt;code&gt;hr-help&lt;/code&gt;, &lt;code&gt;cnypromo&lt;/code&gt; etc. would be in as the &amp;ldquo;key&amp;rdquo;, and the target full links as the respective&amp;nbsp;&amp;ldquo;value&amp;rdquo;.&lt;/li&gt;
&lt;li&gt;Remember &lt;span class="caps"&gt;NOT&lt;/span&gt; to start the short part with &amp;lsquo;/&amp;rsquo;. In the code, it&amp;rsquo;ll be taken care&amp;nbsp;of.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="Create the short-link map as a KV" src="https://i.imgur.com/jkC8bSr.png"&gt;&lt;/p&gt;
&lt;p&gt;Once you&amp;rsquo;ve listed all your desired (short-link, target-link) combinations, now we have a &lt;span class="caps"&gt;KV&lt;/span&gt; on CLoudflare. However, it&amp;rsquo;s not referencable from your Worker code, not yet. Hence the next&amp;nbsp;step.&lt;/p&gt;
&lt;h1 id="mapping-a-kv-to-a-worker-variable"&gt;Mapping a &lt;span class="caps"&gt;KV&lt;/span&gt; to a Worker variable&lt;a class="headerlink" href="#mapping-a-kv-to-a-worker-variable" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Now, we gonna map the previously created &lt;span class="caps"&gt;KV&lt;/span&gt; to a variable that can be referenced from our Workeer code. Please note that though I used diffrent names, but it can be same as well. Also note that a single &lt;span class="caps"&gt;KV&lt;/span&gt; can be accessed by multiple workers, and vice versa, a single Worker can reference multiple&amp;nbsp;KVs.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Mapping a KV to a Worker variable" src="https://i.imgur.com/lb7G9si.png"&gt;&lt;/p&gt;
&lt;h1 id="handling-a-route-with-webworker"&gt;Handling a route with webworker&lt;a class="headerlink" href="#handling-a-route-with-webworker" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;&lt;img alt="Handling a route with webworker" src="https://i.imgur.com/KohHRfR.png"&gt;&lt;/p&gt;
&lt;h1 id="create-the-worker"&gt;Create the Worker&lt;a class="headerlink" href="#create-the-worker" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Now, we going to write Workercode that runs on V8-runtime on an nearest(from the requesting user) edge location of Cloudflare to complete its functionality and deliver it to the user. Tn this case, that would be to redirect user&amp;rsquo;s requested address to the mapped one by you, in the &lt;span class="caps"&gt;KV&lt;/span&gt; namespace&amp;nbsp;above.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Creating a worker" src="https://i.imgur.com/eNfZNyN.png"&gt;&lt;/p&gt;
&lt;p&gt;The code editor looks like&amp;nbsp;this:  &lt;/p&gt;
&lt;p&gt;&lt;img alt="The code editor for Cloudflare worker" src="https://i.imgur.com/pb9AE9v.png"&gt;&lt;/p&gt;
&lt;p&gt;If you rather prefer to copy-paste, please feel free to do it from the below GitHub&amp;nbsp;Gist.&lt;/p&gt;
&lt;div class="gist"&gt;
&lt;script src="https://gist.github.com/kmonsoor/dc9f96660423c96471f8574ba018d867.js"&gt;&lt;/script&gt;
&lt;/div&gt;

&lt;p&gt;Once done, it should look like &amp;hellip;
&lt;img alt="created webworker" src="https://i.imgur.com/XSdKB56.png"&gt;&lt;/p&gt;
&lt;h1 id="pointing-a-dns-record-to-the-worker"&gt;Pointing a &lt;span class="caps"&gt;DNS&lt;/span&gt; record to the Worker&lt;a class="headerlink" href="#pointing-a-dns-record-to-the-worker" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Finally, we need to point a &lt;span class="caps"&gt;DNS&lt;/span&gt; record that&amp;rsquo;ll redirect all requests to your re-soutign sub-domain (e.g. &lt;code&gt;go.your-domain.com&lt;/code&gt;) to the Cloudflare Worker that we just&amp;nbsp;created.&lt;/p&gt;
&lt;p&gt;According to the Cloudflare docs, the &lt;span class="caps"&gt;DNNS&lt;/span&gt; record must be an &lt;span class="caps"&gt;AAAA&lt;/span&gt; record, pointing to the IPv6 address &lt;code&gt;100::&lt;/code&gt;. The &amp;ldquo;Name&amp;rdquo; here is the &amp;ldquo;sub-domain&amp;rdquo; part of your choice which is better be short to serve our goal&amp;nbsp;here.  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pointing a DNS record to it" src="https://i.imgur.com/62bk7pe.png"&gt;&lt;/p&gt;
&lt;p&gt;Voila ! Now, test some of the short-urls that you&amp;rsquo;ve mapped via the &lt;span class="caps"&gt;KV&lt;/span&gt;. Enjoy !
Watch out for the target usage though &lt;a href="https://developers.cloudflare.com/workers/platform/limits#worker-limits"&gt;against the limit&lt;/a&gt;.  &lt;/p&gt;
&lt;p&gt;I think you&amp;rsquo;ll be fine, unnless you&amp;rsquo;re some kind of celebrity&amp;nbsp;;)&lt;/p&gt;
&lt;h1 id="next-step"&gt;Next step&lt;a class="headerlink" href="#next-step" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;As the next next step, I&amp;rsquo;m thinking to create a generic &lt;code&gt;Go/Link&lt;/code&gt; resolver browser extension. Then, someone can set their own default domain or company domain of choice as short-domain host. In that case, entering just &lt;code&gt;go/hr-help&lt;/code&gt; on the browser will take to &lt;code&gt;https://www.company-internal.com/.../hr/contact.html&lt;/code&gt; that we have discussed at the beginning (remember the example case of an internal human resources help&amp;nbsp;portal?).&lt;/p&gt;
&lt;h1 id="related"&gt;Related&lt;a class="headerlink" href="#related" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;If you want to do this url-direction &lt;strong&gt;on your own webserver, but only using webserver&lt;/strong&gt;, try this: &lt;a href="https://blog.kmonsoor.com/personal-shortlink-server-using-Caddy/"&gt;Personal short-link server using only&amp;nbsp;Caddyserver&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="Tech"></category><category term="cloud"></category><category term="computing"></category><category term="url-shortener"></category><category term="url-forwarder"></category><category term="Cloudflare"></category><category term="Cloudflare Worker"></category><category term="Cloudflare KV"></category><category term="Workers KV"></category><category term="on edge"></category><category term="free"></category><category term="go-link"></category></entry><entry><title>TL;DR what cloud provider to use in¬†2021</title><link href="https://blog.kmonsoor.com/TLDR-what-cloud-to-use-2021/" rel="alternate"></link><published>2021-05-22T00:00:00+06:00</published><updated>2021-05-22T00:00:00+06:00</updated><author><name>Khaled Monsoor</name></author><id>tag:blog.kmonsoor.com,2021-05-22:/TLDR-what-cloud-to-use-2021/</id><summary type="html">&lt;p&gt;Among the thousands of combinations a company can take to choose from the cloud providers and their products, this is my &lt;span class="caps"&gt;TL&lt;/span&gt;;&lt;span class="caps"&gt;DR&lt;/span&gt;&amp;nbsp;suggestion&lt;/p&gt;</summary><content type="html">&lt;p&gt;The sheer number of combinations a company can choose from the cloud providers and their product suites is mind-boggling. Hence, I decided to break it down in a concise form for the busy C-suite&amp;nbsp;executives.&lt;/p&gt;
&lt;p&gt;According to my little experiences and humble opinion, I suggest&amp;nbsp;&amp;hellip;&lt;/p&gt;
&lt;p&gt;‚û§ If your company is a small SaaS shop with 10-ish engineers, stick with DigitalOcean, Linode, &lt;span class="caps"&gt;OVH&lt;/span&gt;, etc., which are best known as cloud &amp;ldquo;instance&amp;rdquo; providers.&lt;br&gt;
Think McDonald&amp;rsquo;s; reliable, cheapest, fast, but you won&amp;rsquo;t take your date there. &lt;br&gt;
&lt;strong&gt;Budget&lt;/strong&gt;:&amp;nbsp;üí∞&lt;/p&gt;
&lt;p&gt;‚û§ If you want a whole cloud experience (e.g., &lt;span class="caps"&gt;VPC&lt;/span&gt;, firewall, &lt;span class="caps"&gt;WAF&lt;/span&gt;, etc., on the menu), start with Google Cloud, then try &lt;span class="caps"&gt;AWS&lt;/span&gt; later.&lt;br&gt;
Google Cloud would be the quickest to grasp the cloud concepts and get going. The &lt;span class="caps"&gt;UI&lt;/span&gt; of the &lt;span class="caps"&gt;AWS&lt;/span&gt; console is a bit messy compared to &lt;span class="caps"&gt;GCP&lt;/span&gt;; it just takes more time to get a proper grip.&lt;br&gt;
Imagine them as full-course, Michelin-star restaurants. However, the product names are so abstract that they need a full-sized chart for that. ;) 
&lt;strong&gt;Budget&lt;/strong&gt;:&amp;nbsp;üí∞üí∞üí∞&lt;/p&gt;
&lt;p&gt;‚û§ Are you planning to set up a million-dollar infra for a billion-dollar company? Go for some &lt;span class="caps"&gt;GCP&lt;/span&gt;+&lt;span class="caps"&gt;AWS&lt;/span&gt; multi-cloud setup. You gonna get rebates from both on the scale of hundreds of thousands of dollars. And Microsoft Azure gonna offer you some million-$ free-tier, hoping to get the company hooked on Azure. :D 
&lt;strong&gt;Budget&lt;/strong&gt;:&amp;nbsp;üí∞üí∞&lt;/p&gt;
&lt;p&gt;‚û§ On the other hand, if you run a govt agency or a company where wearing suits is the mainstream, Microsoft Azure is your best bet.&lt;br&gt;
A bunch of consultancy companies to choose from; you need to just approve the budget, you get the things to get up &lt;span class="amp"&gt;&amp;amp;&lt;/span&gt; running but miss the deadline by months, if not years. But there&amp;rsquo;d be no need for hiring more smarter ppl than that you already have. 
&lt;strong&gt;Budget&lt;/strong&gt;:&amp;nbsp;üí∞üí∞üí∏&lt;/p&gt;
&lt;p&gt;Need an even more comprehensive guide? Gotcha, fam&amp;nbsp;&amp;hellip;&lt;/p&gt;
&lt;blockquote class="twitter-tweet"&gt;&lt;p lang="en" dir="ltr"&gt;&lt;span class="caps"&gt;CTO&lt;/span&gt;: we&amp;#39;re having hard time choosing a cloud provider&lt;br&gt;&amp;#8230;&lt;br&gt;&amp;#8220;say no more, fam, I gotcha &amp;#8230;&amp;#8221; &lt;a href="https://t.co/hR3rMruWWi"&gt;pic.twitter.com/hR3rMruWWi&lt;/a&gt;&lt;/p&gt;&amp;mdash; Khaled Monsoor ‚ú® (@kmonsoor) &lt;a href="https://twitter.com/kmonsoor/status/1395959443376857088?ref_src=twsrc%5Etfw"&gt;May 22, 2021&lt;/a&gt;&lt;/blockquote&gt;
&lt;script async src="https://platform.twitter.com/widgets.js" charset="utf-8"&gt;&lt;/script&gt;

&lt;p&gt;&lt;em&gt;&lt;span class="caps"&gt;PS&lt;/span&gt;&lt;/em&gt; This post is inspired by a LinkedIn post of mine where I shared about my short experience with the Microsoft Azure &lt;strong&gt;DevOps&lt;/strong&gt;&amp;nbsp;suite&lt;/p&gt;</content><category term="Tech"></category><category term="computing"></category><category term="cloud"></category><category term="2021"></category><category term="AWS"></category><category term="GCP"></category><category term="Azure"></category><category term="Google Cloud"></category><category term="IaaS"></category></entry><entry><title>HA(High-Availability) Setup for¬†InfluxDB</title><link href="https://blog.kmonsoor.com/ha-setup-for-influxdb/" rel="alternate"></link><published>2018-01-18T00:00:00+06:00</published><updated>2018-01-18T00:00:00+06:00</updated><author><name>Khaled Monsoor</name></author><id>tag:blog.kmonsoor.com,2018-01-18:/ha-setup-for-influxdb/</id><summary type="html">&lt;p&gt;Create a robust, highly-available, time-series InfluxDB cluster with the community(free) version of&amp;nbsp;it&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;strong&gt;&lt;span class="caps"&gt;NOTE&lt;/span&gt;&lt;/strong&gt;
&lt;em&gt;Since I have written this article, all the components used in this below architecture have gone through many updates and releases. While the general premise involving &lt;code&gt;influxdb-relay&lt;/code&gt; and the multiplexing might still hold, please sync up with the latest release docs before jumping into some serious system&amp;nbsp;design.&lt;/em&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Currently, from version 0.9, you cannot create an InfluxDB cluster from the open-sourced free edition. Only commercially available InfluxDB Enterprise can do that for now. That stirred up the early-adopter enthusiast users, especially for their usage in professional setups. They complained that InfluxData, the company behind InfluxDB, is trying to milk the &lt;span class="caps"&gt;OSS&lt;/span&gt; solution for&amp;nbsp;profit.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Archiving isn't easy ... tobias-fischer-PkbZahEG2Ng" src="https://i.imgur.com/0IdYOYnl.jpg"&gt;&lt;/p&gt;
&lt;p&gt;I can&amp;rsquo;t blame the InfluxData guys much, as they got to pay their bills too. So far, we ‚Äî the users of open-source systems ‚Äî couldn&amp;rsquo;t show much promise about the financial realities of the projects. Continuing development of &lt;span class="caps"&gt;OSS&lt;/span&gt; products, by only depending on donations, patrons, or enterprise sponsorship, is far too rare and unpredictable, even for the projects that many successful organizations heavily rely&amp;nbsp;on.&lt;/p&gt;
&lt;p&gt;Anyways, InfluxDB then promised and later introduced &lt;code&gt;Influx Relay&lt;/code&gt; as a complimentary consolation for missing &lt;span class="caps"&gt;HA&lt;/span&gt; parts of InfluxDB. You can get the details here and here about&amp;nbsp;that. &lt;/p&gt;
&lt;h2 id="premise"&gt;Premise&lt;a class="headerlink" href="#premise" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;For my needs, I have to try to create a reliable &lt;span class="caps"&gt;HA&lt;/span&gt;(High-Availability) setup from available free options, hence InfluxDB and the relay. It&amp;rsquo;s quite a bit far from an InfluxDB-cluster in terms of robustness or ease of setup, but it&amp;rsquo;s got the job done, at least for&amp;nbsp;me.&lt;/p&gt;
&lt;p&gt;I needed a setup to receive system-stats from at least 500+ instances and to store them for a while, but without breaking the bank in bills from &lt;span class="caps"&gt;AWS&lt;/span&gt;. Meaning, I could ask for and could use only couple of instances for my&amp;nbsp;solution.&lt;/p&gt;
&lt;p&gt;Here were my&amp;nbsp;trade-offs.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Not too many instances for this purpose. Neither, any of the heavyweight lifters e.g. &lt;span class="caps"&gt;AWS&lt;/span&gt;&amp;rsquo; m3-xlarge etc. To use only what&amp;rsquo;s&amp;nbsp;necessary. &lt;/li&gt;
&lt;li&gt;To satisfy the budget, hence avoiding pay-per-use solutions as far as it is&amp;nbsp;possible.&lt;/li&gt;
&lt;li&gt;Solutions must not be crazy complex, so that handover to the DevOps team be&amp;nbsp;smooth.&lt;/li&gt;
&lt;li&gt;Reading the data would be too rarely w.r.t. writing. The related Grafana dashboards will be only used to investigate issues by a handful of&amp;nbsp;people.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="overall-design"&gt;Overall Design&lt;a class="headerlink" href="#overall-design" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id="write"&gt;Write&lt;a class="headerlink" href="#write" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;From a birds&amp;rsquo; eye view, I decided to use two server instances to run parallelly, hosting InfluxDB on them independently and then sending the same data over to them for storing. This scheme mostly looks like &lt;a href="https://en.wikipedia.org/wiki/Standard_RAID_levels#RAID_1"&gt;&lt;span class="caps"&gt;RAID&lt;/span&gt;-1 systems&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Overall architecture" src="https://i.imgur.com/ZKYIyOd.png"&gt;&lt;/p&gt;
&lt;p&gt;That brings up a couple of&amp;nbsp;challenges.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;None of the agents I used on the sender side could multiplex output. That means, they were able to send data to a single destination, not multiple. 
    On the Windows front, I&amp;rsquo;ve used &lt;code&gt;Telegraf&lt;/code&gt; which is able randomly to switch between pre-listed destinations, but &lt;span class="caps"&gt;NOT&lt;/span&gt; multiple at-once.&lt;br&gt;
    In the case of Linux hosts, I used &lt;code&gt;Netdata&lt;/code&gt; which is excellent in its own right, but unable to send stats to multiple destinations.&lt;br&gt;
  Here comes &lt;code&gt;Influx-relay&lt;/code&gt;. It can receive time-series data-stream from hosts on a &lt;span class="caps"&gt;TCP&lt;/span&gt; or &lt;span class="caps"&gt;UDP&lt;/span&gt; port, buffer for a while, and then re-send those received and buffered data to multiple receive ends which can either be an InfluxDB instance or another listening Influx-relay instances.&lt;br&gt;
  This chaining can broaden the relaying scheme even further. However, for my purpose, this relay-chaining was not necessary. Rather, from the relay, I am sending data to the separate InfluxDB instances, running on two separate&amp;nbsp;instances.  &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Now that I partially multiplexed the output, my hosts (senders) still are able to send to one destination. So, I need a proxy as well as a load-balancer. For a while, I was torn between &lt;span class="caps"&gt;NGINX&lt;/span&gt; and HAProxy. Both were new to&amp;nbsp;me.  &lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;However, for a couple of reasons, I went for HAProxy.  Firstly, I don&amp;rsquo;t need &lt;span class="caps"&gt;HTTP&lt;/span&gt; session management. Secondly, as I wanted to keep my &lt;span class="caps"&gt;UDP&lt;/span&gt; for later, HAProxy was perfectly capable of that.&lt;br&gt;
  &lt;span class="caps"&gt;NGINX&lt;/span&gt; has the support recently, but the maturity was a concern. Also, configuring &lt;span class="caps"&gt;NGINX&lt;/span&gt; seems a little intimidating (which I know might not be so true). Last but not least, and for what it&amp;rsquo;s worth, out-of-the-box, HAProxy&amp;rsquo;s stat page carries much more in-depth information than that of free-version of &lt;span class="caps"&gt;NGINX&lt;/span&gt;.&lt;br&gt;
  Upon receiving the stats stream, HAProxy was supposed to send that to different Influx-relays in a load-balanced&amp;nbsp;fashion.&lt;/p&gt;
&lt;p&gt;So, here&amp;rsquo;s my rough&amp;nbsp;plan. &lt;/p&gt;
&lt;p&gt;collector-agent &amp;rarr; HAProxy &amp;rarr; (50/50 load-balanced) &amp;rarr; Influx-relay &amp;rarr; (multiplexed)  &amp;rarr;  2 InfluxDB&amp;nbsp;instances&lt;/p&gt;
&lt;p&gt;Now, each one of the received data is to go to both of the InfluxDB instances, or at least to one in case of failure (or, overload per se) of any the relays or Influx instances. ¬†
Also, I have chosen to keep Influx-relays deployed as Dockerized and kept HAProxy and InfluxDB instances running as native services. Of course, you can Dockerize HAProxy and InfluxDB,&amp;nbsp;too.  &lt;/p&gt;
&lt;h3 id="read"&gt;Read&lt;a class="headerlink" href="#read" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;As I&amp;rsquo;ve already noted in the section that reading the data, meaning to fetch data to visualize on Grafana end, will happen rarely and sporadically; only to investigate alarms or any other client-side performance&amp;nbsp;issues.  &lt;/p&gt;
&lt;p&gt;So, the read requests, reaching the HAProxy end, needed not much routing, other than directly to InfluxDB itself. Still, to better distribute the load I decided to load-balance it 50/50&amp;nbsp;basis.&lt;/p&gt;
&lt;h3 id="ports"&gt;Ports&lt;a class="headerlink" href="#ports" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;As all the &lt;span class="caps"&gt;READ&lt;/span&gt; requests are routed through &lt;code&gt;HAProxy&lt;/code&gt; running on each of the instances, to the external world only HAProxy&amp;rsquo;s port should be opened for this&amp;nbsp;purpose. &lt;/li&gt;
&lt;li&gt;On the other hand, for &lt;span class="caps"&gt;WRITE&lt;/span&gt; requests, InfluxDBs are receiving data from relays, one of its own instance and another one on other instance, so InfluxDB should listen on its own port for &lt;span class="caps"&gt;WRITE&lt;/span&gt; requests only. But, this must be accessible only from own &lt;span class="caps"&gt;VPS&lt;/span&gt; zone, but not open to the outside&amp;nbsp;world.&lt;/li&gt;
&lt;li&gt;In case of HAProxy as well as InfluxDB, you can use the default ports, obviously, which is 8086 &lt;span class="amp"&gt;&amp;amp;&lt;/span&gt; 8088 respectively. Or, you can choose to go for other ports (security through obfuscation). Your call. In this writing, I&amp;rsquo;ll go with the&amp;nbsp;defaults.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="authentication-ssl"&gt;Authentication, &lt;span class="caps"&gt;SSL&lt;/span&gt;&lt;a class="headerlink" href="#authentication-ssl" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;You can configure &lt;span class="caps"&gt;SSL&lt;/span&gt; with your own server certificates through the HAProxy configs. You can even go for &lt;span class="caps"&gt;SSL&lt;/span&gt; from the relays to InfluxDB writes. If your sender hosts are connecting to your HAProxy through public internet, you should at least go for password-based authentication, better to utilize &lt;span class="caps"&gt;SSL&lt;/span&gt;. However, for brevity&amp;rsquo;s sake, I&amp;rsquo;ll skip them in this&amp;nbsp;post.&lt;/p&gt;
&lt;p&gt;**Note: *
Please bear in mind, this is an &amp;ldquo;in-progress&amp;rdquo; post; prematurely published to force me to work on it. I have the plan to add all the necessary configurations &lt;span class="amp"&gt;&amp;amp;&lt;/span&gt; commands, that I used,&amp;nbsp;here.&lt;/p&gt;</content><category term="Tech"></category><category term="Linux"></category><category term="influxdb"></category><category term="influx-relay"></category><category term="haproxy"></category><category term="monitoring"></category><category term="computing"></category><category term="time-series"></category><category term="database"></category><category term="open-source"></category><category term="reliability"></category><category term="architecture"></category></entry><entry><title>Characters Efficient Flow in Designing Bangla¬†Font</title><link href="https://blog.kmonsoor.com/bangla-font-design-characters-flow/" rel="alternate"></link><published>2013-08-22T00:00:00+06:00</published><updated>2013-08-22T00:00:00+06:00</updated><author><name>Khaled Monsoor</name></author><id>tag:blog.kmonsoor.com,2013-08-22:/bangla-font-design-characters-flow/</id><summary type="html">&lt;p&gt;How to efficiently progress in designing font through Bangla&amp;nbsp;characters.&lt;/p&gt;</summary><content type="html">&lt;h2 id="optimized-workflow-for-designing-basic-characters-in-bangla-bengali-script"&gt;Optimized workflow for designing basic characters in Bangla / Bengali script&lt;a class="headerlink" href="#optimized-workflow-for-designing-basic-characters-in-bangla-bengali-script" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;img alt="Bangla font design flow" src="http://i.imgur.com/y9Av5yN.png"&gt;&lt;/p&gt;</content><category term="Language"></category><category term="bangla"></category><category term="language"></category><category term="font-design"></category><category term="computing"></category><category term="communication"></category></entry></feed>